function [decMBY,decMBCr,decMBCb] = decodeMB(BlockEntityArray, MotionVectors, ...
                                             mBType, mBIndex, qScale )
% Inputs:
% BlockEntityArray: Array of BlockEntity structures.
% MotionVectors: Array of Motion Vectors
% mBType: Macroblock Type.
% mBIndex: Current macroblock index.
% qScale: Quantization scale.
% 
% Outputs:
% decMBY,decMBCr,decMBCb: Y , Cr, Cb channels of decoded macroblock.
%                       Arrays of 16x16,8x8,8x8 respectively
%

if mBType == 2 || mBType ==  3 % Read motion vectors if necessary
    mv = MotionVectors;
    %     readMV
end

% x = zeros(1,6);
for bIndex = 1:6
%     readBHeader
    x(bIndex) = decodeBlock(BlockEntityArray(bIndex),mBType, qScale);
end

erry = [x(1) x(2) ; x(3) x(4)];
errcb = x(5);
errcr = x(6);
switch (mBType)
    case 2
        [mbY, mbCr, mbCB] = imotestP(y,cr,cb , mv,...
                                buf(1).frameY,buf(1).frameCr,buf(1).frameCb);
    case 3
        [mbY, mbCr, mbCB] = imotestB(erry,errcr,errcb,mBIndex, mv,...
                                     buf(1).frameY,buf(1).frameCr,buf(1).frameCb.);
    case 1
        decMBY = [x(1) x(2) ; x(3) x(4)];
        decMBCb = x(5);
        decMBCr = x(6);
end
end

